var To=Object.defineProperty;var Ro=(t,e,n)=>e in t?To(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var gt=(t,e,n)=>Ro(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function $n(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Xn(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function No(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");$n(t.outputLen),$n(t.blockLen)}function Qt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Oo(t,e){Xn(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ve=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Qn=t=>t instanceof Uint8Array,xe=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),et=(t,e)=>t<<32-e|t>>>e,Ho=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ho)throw new Error("Non little-endian hardware is not supported");function Mo(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Fe(t){if(typeof t=="string"&&(t=Mo(t)),!Qn(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Po(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!Qn(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let tr=class{clone(){return this._cloneInto()}};function qo(t){const e=r=>t().update(Fe(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function er(t=32){if(ve&&typeof ve.getRandomValues=="function")return ve.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Wo(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,f=r?0:4;t.setUint32(e+a,s,r),t.setUint32(e+f,c,r)}let jo=class extends tr{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=xe(this.buffer)}update(e){Qt(this);const{view:n,buffer:r,blockLen:o}=this;e=Fe(e);const i=e.length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=xe(e);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(e.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Qt(this),Oo(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let u=s;u<o;u++)n[u]=0;Wo(r,o-8,BigInt(this.length*8),i),this.process(r,0);const c=xe(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=a/4,h=this.get();if(f>h.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,h[u],i)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=s,o%n&&e.buffer.set(r),e}};const Do=(t,e,n)=>t&e^~t&n,zo=(t,e,n)=>t&e^t&n^e&n,Ko=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),yt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wt=new Uint32Array(64);let Vo=class extends jo{constructor(){super(64,32,8,!1),this.A=yt[0]|0,this.B=yt[1]|0,this.C=yt[2]|0,this.D=yt[3]|0,this.E=yt[4]|0,this.F=yt[5]|0,this.G=yt[6]|0,this.H=yt[7]|0}get(){const{A:e,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[e,n,r,o,i,s,c,a]}set(e,n,r,o,i,s,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(e,n){for(let u=0;u<16;u++,n+=4)wt[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){const y=wt[u-15],m=wt[u-2],g=et(y,7)^et(y,18)^y>>>3,l=et(m,17)^et(m,19)^m>>>10;wt[u]=l+wt[u-7]+g+wt[u-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:f,H:h}=this;for(let u=0;u<64;u++){const y=et(c,6)^et(c,11)^et(c,25),m=h+y+Do(c,a,f)+Ko[u]+wt[u]|0,l=(et(r,2)^et(r,13)^et(r,22))+zo(r,o,i)|0;h=f,f=a,a=c,c=s+m|0,s=i,i=o,o=r,r=m+l|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,h=h+this.H|0,this.set(r,o,i,s,c,a,f,h)}roundClean(){wt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Te=qo(()=>new Vo);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const nr=BigInt(0),se=BigInt(1),Fo=BigInt(2),ae=t=>t instanceof Uint8Array,Zo=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ot(t){if(!ae(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Zo[t[n]];return e}function rr(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function Ze(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Ht(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const o=r*2,i=t.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function Z(t){return Ze(Ot(t))}function Ge(t){if(!ae(t))throw new Error("Uint8Array expected");return Ze(Ot(Uint8Array.from(t).reverse()))}function xt(t,e){return Ht(t.toString(16).padStart(e*2,"0"))}function Je(t,e){return xt(t,e).reverse()}function Go(t){return Ht(rr(t))}function K(t,e,n){let r;if(typeof e=="string")try{r=Ht(e)}catch(i){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${i}`)}else if(ae(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function Lt(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!ae(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function Jo(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Yo(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Xo(t){let e;for(e=0;t>nr;t>>=se,e+=1);return e}function Qo(t,e){return t>>BigInt(e)&se}const ti=(t,e,n)=>t|(n?se:nr)<<BigInt(e),Ye=t=>(Fo<<BigInt(t-1))-se,Ae=t=>new Uint8Array(t),Cn=t=>Uint8Array.from(t);function or(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Ae(t),o=Ae(t),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},c=(...u)=>n(o,r,...u),a=(u=Ae())=>{o=c(Cn([0]),u),r=c(),u.length!==0&&(o=c(Cn([1]),u),r=c())},f=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const y=[];for(;u<e;){r=c();const m=r.slice();y.push(m),u+=r.length}return Lt(...y)};return(u,y)=>{s(),a(u);let m;for(;!(m=y(f()));)a();return s(),m}}const ei={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Gt(t,e,n={}){const r=(o,i,s)=>{const c=ei[i];if(typeof c!="function")throw new Error(`Invalid validator "${i}", expected function`);const a=t[o];if(!(s&&a===void 0)&&!c(a,t))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${i}`)};for(const[o,i]of Object.entries(e))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return t}const ni=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Qo,bitLen:Xo,bitMask:Ye,bitSet:ti,bytesToHex:Ot,bytesToNumberBE:Z,bytesToNumberLE:Ge,concatBytes:Lt,createHmacDrbg:or,ensureBytes:K,equalBytes:Jo,hexToBytes:Ht,hexToNumber:Ze,numberToBytesBE:xt,numberToBytesLE:Je,numberToHexUnpadded:rr,numberToVarBytesBE:Go,utf8ToBytes:Yo,validateObject:Gt},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const D=BigInt(0),j=BigInt(1),Bt=BigInt(2),ri=BigInt(3),Re=BigInt(4),Tn=BigInt(5),Rn=BigInt(8);BigInt(9);BigInt(16);function z(t,e){const n=t%e;return n>=D?n:e+n}function oi(t,e,n){if(n<=D||e<D)throw new Error("Expected power/modulo > 0");if(n===j)return D;let r=j;for(;e>D;)e&j&&(r=r*t%n),t=t*t%n,e>>=j;return r}function G(t,e,n){let r=t;for(;e-- >D;)r*=r,r%=n;return r}function Ne(t,e){if(t===D||e<=D)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=z(t,e),r=e,o=D,i=j;for(;n!==D;){const c=r/n,a=r%n,f=o-i*c;r=n,n=a,o=i,i=f}if(r!==j)throw new Error("invert: does not exist");return z(o,e)}function ii(t){const e=(t-j)/Bt;let n,r,o;for(n=t-j,r=0;n%Bt===D;n/=Bt,r++);for(o=Bt;o<t&&oi(o,e,t)!==t-j;o++);if(r===1){const s=(t+j)/Re;return function(a,f){const h=a.pow(f,s);if(!a.eql(a.sqr(h),f))throw new Error("Cannot find square root");return h}}const i=(n+j)/Bt;return function(c,a){if(c.pow(a,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let f=r,h=c.pow(c.mul(c.ONE,o),n),u=c.pow(a,i),y=c.pow(a,n);for(;!c.eql(y,c.ONE);){if(c.eql(y,c.ZERO))return c.ZERO;let m=1;for(let l=c.sqr(y);m<f&&!c.eql(l,c.ONE);m++)l=c.sqr(l);const g=c.pow(h,j<<BigInt(f-m-1));h=c.sqr(g),u=c.mul(u,g),y=c.mul(y,h),f=m}return u}}function si(t){if(t%Re===ri){const e=(t+j)/Re;return function(r,o){const i=r.pow(o,e);if(!r.eql(r.sqr(i),o))throw new Error("Cannot find square root");return i}}if(t%Rn===Tn){const e=(t-Tn)/Rn;return function(r,o){const i=r.mul(o,Bt),s=r.pow(i,e),c=r.mul(o,s),a=r.mul(r.mul(c,Bt),s),f=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(f),o))throw new Error("Cannot find square root");return f}}return ii(t)}const ai=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ci(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=ai.reduce((r,o)=>(r[o]="function",r),e);return Gt(t,n)}function li(t,e,n){if(n<D)throw new Error("Expected power > 0");if(n===D)return t.ONE;if(n===j)return e;let r=t.ONE,o=e;for(;n>D;)n&j&&(r=t.mul(r,o)),o=t.sqr(o),n>>=j;return r}function ui(t,e){const n=new Array(e.length),r=e.reduce((i,s,c)=>t.is0(s)?i:(n[c]=i,t.mul(i,s)),t.ONE),o=t.inv(r);return e.reduceRight((i,s,c)=>t.is0(s)?i:(n[c]=t.mul(i,n[c]),t.mul(i,s)),o),n}function ir(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function fi(t,e,n=!1,r={}){if(t<=D)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:o,nByteLength:i}=ir(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=si(t),c=Object.freeze({ORDER:t,BITS:o,BYTES:i,MASK:Ye(o),ZERO:D,ONE:j,create:a=>z(a,t),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return D<=a&&a<t},is0:a=>a===D,isOdd:a=>(a&j)===j,neg:a=>z(-a,t),eql:(a,f)=>a===f,sqr:a=>z(a*a,t),add:(a,f)=>z(a+f,t),sub:(a,f)=>z(a-f,t),mul:(a,f)=>z(a*f,t),pow:(a,f)=>li(c,a,f),div:(a,f)=>z(a*Ne(f,t),t),sqrN:a=>a*a,addN:(a,f)=>a+f,subN:(a,f)=>a-f,mulN:(a,f)=>a*f,inv:a=>Ne(a,t),sqrt:r.sqrt||(a=>s(c,a)),invertBatch:a=>ui(c,a),cmov:(a,f,h)=>h?f:a,toBytes:a=>n?Je(a,i):xt(a,i),fromBytes:a=>{if(a.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${a.length}`);return n?Ge(a):Z(a)}});return Object.freeze(c)}function sr(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function ar(t){const e=sr(t);return e+Math.ceil(e/2)}function di(t,e,n=!1){const r=t.length,o=sr(e),i=ar(e);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const s=n?Z(t):Ge(t),c=z(s,e-j)+j;return n?Je(c,o):xt(c,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const hi=BigInt(0),ke=BigInt(1);function pi(t,e){const n=(o,i)=>{const s=i.negate();return o?s:i},r=o=>{const i=Math.ceil(e/o)+1,s=2**(o-1);return{windows:i,windowSize:s}};return{constTimeNegate:n,unsafeLadder(o,i){let s=t.ZERO,c=o;for(;i>hi;)i&ke&&(s=s.add(c)),c=c.double(),i>>=ke;return s},precomputeWindow(o,i){const{windows:s,windowSize:c}=r(i),a=[];let f=o,h=f;for(let u=0;u<s;u++){h=f,a.push(h);for(let y=1;y<c;y++)h=h.add(f),a.push(h);f=h.double()}return a},wNAF(o,i,s){const{windows:c,windowSize:a}=r(o);let f=t.ZERO,h=t.BASE;const u=BigInt(2**o-1),y=2**o,m=BigInt(o);for(let g=0;g<c;g++){const l=g*a;let d=Number(s&u);s>>=m,d>a&&(d-=y,s+=ke);const p=l,b=l+Math.abs(d)-1,v=g%2!==0,L=d<0;d===0?h=h.add(n(v,i[p])):f=f.add(n(L,i[b]))}return{p:f,f:h}},wNAFCached(o,i,s,c){const a=o._WINDOW_SIZE||1;let f=i.get(o);return f||(f=this.precomputeWindow(o,a),a!==1&&i.set(o,c(f))),this.wNAF(a,f,s)}}}function cr(t){return ci(t.Fp),Gt(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ir(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function gi(t){const e=cr(t);Gt(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:yi,hexToBytes:wi}=ni,St={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=St;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:yi(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=St,n=typeof t=="string"?wi(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:o,l:i}=St._parseInt(n.subarray(2)),{d:s,l:c}=St._parseInt(i);if(c.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s}},hexFromSig(t){const e=f=>Number.parseInt(f[0],16)&8?"00"+f:f,n=f=>{const h=f.toString(16);return h.length&1?`0${h}`:h},r=e(n(t.s)),o=e(n(t.r)),i=r.length/2,s=o.length/2,c=n(i),a=n(s);return`30${n(s+i+4)}02${a}${o}02${c}${r}`}},st=BigInt(0),J=BigInt(1);BigInt(2);const Nn=BigInt(3);BigInt(4);function bi(t){const e=gi(t),{Fp:n}=e,r=e.toBytes||((g,l,d)=>{const p=l.toAffine();return Lt(Uint8Array.from([4]),n.toBytes(p.x),n.toBytes(p.y))}),o=e.fromBytes||(g=>{const l=g.subarray(1),d=n.fromBytes(l.subarray(0,n.BYTES)),p=n.fromBytes(l.subarray(n.BYTES,2*n.BYTES));return{x:d,y:p}});function i(g){const{a:l,b:d}=e,p=n.sqr(g),b=n.mul(p,g);return n.add(n.add(b,n.mul(g,l)),d)}if(!n.eql(n.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function s(g){return typeof g=="bigint"&&st<g&&g<e.n}function c(g){if(!s(g))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(g){const{allowedPrivateKeyLengths:l,nByteLength:d,wrapPrivateKey:p,n:b}=e;if(l&&typeof g!="bigint"){if(g instanceof Uint8Array&&(g=Ot(g)),typeof g!="string"||!l.includes(g.length))throw new Error("Invalid key");g=g.padStart(d*2,"0")}let v;try{v=typeof g=="bigint"?g:Z(K("private key",g,d))}catch{throw new Error(`private key must be ${d} bytes, hex or bigint, not ${typeof g}`)}return p&&(v=z(v,b)),c(v),v}const f=new Map;function h(g){if(!(g instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(l,d,p){if(this.px=l,this.py=d,this.pz=p,l==null||!n.isValid(l))throw new Error("x required");if(d==null||!n.isValid(d))throw new Error("y required");if(p==null||!n.isValid(p))throw new Error("z required")}static fromAffine(l){const{x:d,y:p}=l||{};if(!l||!n.isValid(d)||!n.isValid(p))throw new Error("invalid affine point");if(l instanceof u)throw new Error("projective point not allowed");const b=v=>n.eql(v,n.ZERO);return b(d)&&b(p)?u.ZERO:new u(d,p,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(l){const d=n.invertBatch(l.map(p=>p.pz));return l.map((p,b)=>p.toAffine(d[b])).map(u.fromAffine)}static fromHex(l){const d=u.fromAffine(o(K("pointHex",l)));return d.assertValidity(),d}static fromPrivateKey(l){return u.BASE.multiply(a(l))}_setWindowSize(l){this._WINDOW_SIZE=l,f.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:l,y:d}=this.toAffine();if(!n.isValid(l)||!n.isValid(d))throw new Error("bad point: x or y not FE");const p=n.sqr(d),b=i(l);if(!n.eql(p,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:l}=this.toAffine();if(n.isOdd)return!n.isOdd(l);throw new Error("Field doesn't support isOdd")}equals(l){h(l);const{px:d,py:p,pz:b}=this,{px:v,py:L,pz:_}=l,x=n.eql(n.mul(d,_),n.mul(v,b)),k=n.eql(n.mul(p,_),n.mul(L,b));return x&&k}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:l,b:d}=e,p=n.mul(d,Nn),{px:b,py:v,pz:L}=this;let _=n.ZERO,x=n.ZERO,k=n.ZERO,A=n.mul(b,b),$=n.mul(v,v),I=n.mul(L,L),S=n.mul(b,v);return S=n.add(S,S),k=n.mul(b,L),k=n.add(k,k),_=n.mul(l,k),x=n.mul(p,I),x=n.add(_,x),_=n.sub($,x),x=n.add($,x),x=n.mul(_,x),_=n.mul(S,_),k=n.mul(p,k),I=n.mul(l,I),S=n.sub(A,I),S=n.mul(l,S),S=n.add(S,k),k=n.add(A,A),A=n.add(k,A),A=n.add(A,I),A=n.mul(A,S),x=n.add(x,A),I=n.mul(v,L),I=n.add(I,I),A=n.mul(I,S),_=n.sub(_,A),k=n.mul(I,$),k=n.add(k,k),k=n.add(k,k),new u(_,x,k)}add(l){h(l);const{px:d,py:p,pz:b}=this,{px:v,py:L,pz:_}=l;let x=n.ZERO,k=n.ZERO,A=n.ZERO;const $=e.a,I=n.mul(e.b,Nn);let S=n.mul(d,v),O=n.mul(p,L),H=n.mul(b,_),W=n.add(d,p),w=n.add(v,L);W=n.mul(W,w),w=n.add(S,O),W=n.sub(W,w),w=n.add(d,b);let E=n.add(v,_);return w=n.mul(w,E),E=n.add(S,H),w=n.sub(w,E),E=n.add(p,b),x=n.add(L,_),E=n.mul(E,x),x=n.add(O,H),E=n.sub(E,x),A=n.mul($,w),x=n.mul(I,H),A=n.add(x,A),x=n.sub(O,A),A=n.add(O,A),k=n.mul(x,A),O=n.add(S,S),O=n.add(O,S),H=n.mul($,H),w=n.mul(I,w),O=n.add(O,H),H=n.sub(S,H),H=n.mul($,H),w=n.add(w,H),S=n.mul(O,w),k=n.add(k,S),S=n.mul(E,w),x=n.mul(W,x),x=n.sub(x,S),S=n.mul(W,O),A=n.mul(E,A),A=n.add(A,S),new u(x,k,A)}subtract(l){return this.add(l.negate())}is0(){return this.equals(u.ZERO)}wNAF(l){return m.wNAFCached(this,f,l,d=>{const p=n.invertBatch(d.map(b=>b.pz));return d.map((b,v)=>b.toAffine(p[v])).map(u.fromAffine)})}multiplyUnsafe(l){const d=u.ZERO;if(l===st)return d;if(c(l),l===J)return this;const{endo:p}=e;if(!p)return m.unsafeLadder(this,l);let{k1neg:b,k1:v,k2neg:L,k2:_}=p.splitScalar(l),x=d,k=d,A=this;for(;v>st||_>st;)v&J&&(x=x.add(A)),_&J&&(k=k.add(A)),A=A.double(),v>>=J,_>>=J;return b&&(x=x.negate()),L&&(k=k.negate()),k=new u(n.mul(k.px,p.beta),k.py,k.pz),x.add(k)}multiply(l){c(l);let d=l,p,b;const{endo:v}=e;if(v){const{k1neg:L,k1:_,k2neg:x,k2:k}=v.splitScalar(d);let{p:A,f:$}=this.wNAF(_),{p:I,f:S}=this.wNAF(k);A=m.constTimeNegate(L,A),I=m.constTimeNegate(x,I),I=new u(n.mul(I.px,v.beta),I.py,I.pz),p=A.add(I),b=$.add(S)}else{const{p:L,f:_}=this.wNAF(d);p=L,b=_}return u.normalizeZ([p,b])[0]}multiplyAndAddUnsafe(l,d,p){const b=u.BASE,v=(_,x)=>x===st||x===J||!_.equals(b)?_.multiplyUnsafe(x):_.multiply(x),L=v(this,d).add(v(l,p));return L.is0()?void 0:L}toAffine(l){const{px:d,py:p,pz:b}=this,v=this.is0();l==null&&(l=v?n.ONE:n.inv(b));const L=n.mul(d,l),_=n.mul(p,l),x=n.mul(b,l);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:L,y:_}}isTorsionFree(){const{h:l,isTorsionFree:d}=e;if(l===J)return!0;if(d)return d(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:l,clearCofactor:d}=e;return l===J?this:d?d(u,this):this.multiplyUnsafe(e.h)}toRawBytes(l=!0){return this.assertValidity(),r(u,this,l)}toHex(l=!0){return Ot(this.toRawBytes(l))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const y=e.nBitLength,m=pi(u,e.endo?Math.ceil(y/2):y);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:s}}function mi(t){const e=cr(t);return Gt(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Ei(t){const e=mi(t),{Fp:n,n:r}=e,o=n.BYTES+1,i=2*n.BYTES+1;function s(w){return st<w&&w<n.ORDER}function c(w){return z(w,r)}function a(w){return Ne(w,r)}const{ProjectivePoint:f,normPrivateKeyToScalar:h,weierstrassEquation:u,isWithinCurveOrder:y}=bi({...e,toBytes(w,E,B){const C=E.toAffine(),U=n.toBytes(C.x),T=Lt;return B?T(Uint8Array.from([E.hasEvenY()?2:3]),U):T(Uint8Array.from([4]),U,n.toBytes(C.y))},fromBytes(w){const E=w.length,B=w[0],C=w.subarray(1);if(E===o&&(B===2||B===3)){const U=Z(C);if(!s(U))throw new Error("Point is not on curve");const T=u(U);let M=n.sqrt(T);const N=(M&J)===J;return(B&1)===1!==N&&(M=n.neg(M)),{x:U,y:M}}else if(E===i&&B===4){const U=n.fromBytes(C.subarray(0,n.BYTES)),T=n.fromBytes(C.subarray(n.BYTES,2*n.BYTES));return{x:U,y:T}}else throw new Error(`Point of length ${E} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}}),m=w=>Ot(xt(w,e.nByteLength));function g(w){const E=r>>J;return w>E}function l(w){return g(w)?c(-w):w}const d=(w,E,B)=>Z(w.slice(E,B));class p{constructor(E,B,C){this.r=E,this.s=B,this.recovery=C,this.assertValidity()}static fromCompact(E){const B=e.nByteLength;return E=K("compactSignature",E,B*2),new p(d(E,0,B),d(E,B,2*B))}static fromDER(E){const{r:B,s:C}=St.toSig(K("DER",E));return new p(B,C)}assertValidity(){if(!y(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!y(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new p(this.r,this.s,E)}recoverPublicKey(E){const{r:B,s:C,recovery:U}=this,T=k(K("msgHash",E));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const M=U===2||U===3?B+e.n:B;if(M>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const N=U&1?"03":"02",Y=f.fromHex(N+m(M)),ht=a(M),Ut=c(-T*ht),jt=c(C*ht),pt=f.BASE.multiplyAndAddUnsafe(Y,Ut,jt);if(!pt)throw new Error("point at infinify");return pt.assertValidity(),pt}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Ht(this.toDERHex())}toDERHex(){return St.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ht(this.toCompactHex())}toCompactHex(){return m(this.r)+m(this.s)}}const b={isValidPrivateKey(w){try{return h(w),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const w=ar(e.n);return di(e.randomBytes(w),e.n)},precompute(w=8,E=f.BASE){return E._setWindowSize(w),E.multiply(BigInt(3)),E}};function v(w,E=!0){return f.fromPrivateKey(w).toRawBytes(E)}function L(w){const E=w instanceof Uint8Array,B=typeof w=="string",C=(E||B)&&w.length;return E?C===o||C===i:B?C===2*o||C===2*i:w instanceof f}function _(w,E,B=!0){if(L(w))throw new Error("first arg must be private key");if(!L(E))throw new Error("second arg must be public key");return f.fromHex(E).multiply(h(w)).toRawBytes(B)}const x=e.bits2int||function(w){const E=Z(w),B=w.length*8-e.nBitLength;return B>0?E>>BigInt(B):E},k=e.bits2int_modN||function(w){return c(x(w))},A=Ye(e.nBitLength);function $(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(st<=w&&w<A))throw new Error(`bigint expected < 2^${e.nBitLength}`);return xt(w,e.nByteLength)}function I(w,E,B=S){if(["recovered","canonical"].some(kt=>kt in B))throw new Error("sign() legacy options not supported");const{hash:C,randomBytes:U}=e;let{lowS:T,prehash:M,extraEntropy:N}=B;T==null&&(T=!0),w=K("msgHash",w),M&&(w=K("prehashed msgHash",C(w)));const Y=k(w),ht=h(E),Ut=[$(ht),$(Y)];if(N!=null){const kt=N===!0?U(n.BYTES):N;Ut.push(K("extraEntropy",kt))}const jt=Lt(...Ut),pt=Y;function Ee(kt){const $t=x(kt);if(!y($t))return;const _n=a($t),Ct=f.BASE.multiply($t).toAffine(),X=c(Ct.x);if(X===st)return;const Tt=c(_n*c(pt+X*ht));if(Tt===st)return;let In=(Ct.x===X?0:2)|Number(Ct.y&J),Un=Tt;return T&&g(Tt)&&(Un=l(Tt),In^=1),new p(X,Un,In)}return{seed:jt,k2sig:Ee}}const S={lowS:e.lowS,prehash:!1},O={lowS:e.lowS,prehash:!1};function H(w,E,B=S){const{seed:C,k2sig:U}=I(w,E,B),T=e;return or(T.hash.outputLen,T.nByteLength,T.hmac)(C,U)}f.BASE._setWindowSize(8);function W(w,E,B,C=O){var Ct;const U=w;if(E=K("msgHash",E),B=K("publicKey",B),"strict"in C)throw new Error("options.strict was renamed to lowS");const{lowS:T,prehash:M}=C;let N,Y;try{if(typeof U=="string"||U instanceof Uint8Array)try{N=p.fromDER(U)}catch(X){if(!(X instanceof St.Err))throw X;N=p.fromCompact(U)}else if(typeof U=="object"&&typeof U.r=="bigint"&&typeof U.s=="bigint"){const{r:X,s:Tt}=U;N=new p(X,Tt)}else throw new Error("PARSE");Y=f.fromHex(B)}catch(X){if(X.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(T&&N.hasHighS())return!1;M&&(E=e.hash(E));const{r:ht,s:Ut}=N,jt=k(E),pt=a(Ut),Ee=c(jt*pt),kt=c(ht*pt),$t=(Ct=f.BASE.multiplyAndAddUnsafe(Y,Ee,kt))==null?void 0:Ct.toAffine();return $t?c($t.x)===ht:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:_,sign:H,verify:W,ProjectivePoint:f,Signature:p,utils:b}}let lr=class extends tr{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,No(e);const r=Fe(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?e.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(e){return Qt(this),this.iHash.update(e),this}digestInto(e){Qt(this),Xn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const ur=(t,e,n)=>new lr(t,e).update(n).digest();ur.create=(t,e)=>new lr(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function vi(t){return{hash:t,hmac:(e,...n)=>ur(t,e,Po(...n)),randomBytes:er}}function xi(t,e){const n=r=>Ei({...t,...vi(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ce=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),te=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),fr=BigInt(1),ee=BigInt(2),On=(t,e)=>(t+e/ee)/e;function dr(t){const e=ce,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),c=BigInt(44),a=BigInt(88),f=t*t*t%e,h=f*f*t%e,u=G(h,n,e)*h%e,y=G(u,n,e)*h%e,m=G(y,ee,e)*f%e,g=G(m,o,e)*m%e,l=G(g,i,e)*g%e,d=G(l,c,e)*l%e,p=G(d,a,e)*d%e,b=G(p,c,e)*l%e,v=G(b,n,e)*h%e,L=G(v,s,e)*g%e,_=G(L,r,e)*f%e,x=G(_,ee,e);if(!Oe.eql(Oe.sqr(x),t))throw new Error("Cannot find square root");return x}const Oe=fi(ce,void 0,void 0,{sqrt:dr}),Pt=xi({a:BigInt(0),b:BigInt(7),Fp:Oe,n:te,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=te,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-fr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),c=On(i*t,e),a=On(-r*t,e);let f=z(t-c*n-a*o,e),h=z(-c*r-a*i,e);const u=f>s,y=h>s;if(u&&(f=e-f),y&&(h=e-h),f>s||h>s)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:f,k2neg:y,k2:h}}}},Te),le=BigInt(0),hr=t=>typeof t=="bigint"&&le<t&&t<ce,Ai=t=>typeof t=="bigint"&&le<t&&t<te,Hn={};function ne(t,...e){let n=Hn[t];if(n===void 0){const r=Te(Uint8Array.from(t,o=>o.charCodeAt(0)));n=Lt(r,r),Hn[t]=n}return Te(Lt(n,...e))}const Xe=t=>t.toRawBytes(!0).slice(1),He=t=>xt(t,32),Be=t=>z(t,ce),Vt=t=>z(t,te),Qe=Pt.ProjectivePoint,ki=(t,e,n)=>Qe.BASE.multiplyAndAddUnsafe(t,e,n);function Me(t){let e=Pt.utils.normPrivateKeyToScalar(t),n=Qe.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Vt(-e),bytes:Xe(n)}}function pr(t){if(!hr(t))throw new Error("bad x: need 0 < x < p");const e=Be(t*t),n=Be(e*t+BigInt(7));let r=dr(n);r%ee!==le&&(r=Be(-r));const o=new Qe(t,r,fr);return o.assertValidity(),o}function gr(...t){return Vt(Z(ne("BIP0340/challenge",...t)))}function Bi(t){return Me(t).bytes}function Si(t,e,n=er(32)){const r=K("message",t),{bytes:o,scalar:i}=Me(e),s=K("auxRand",n,32),c=He(i^Z(ne("BIP0340/aux",s))),a=ne("BIP0340/nonce",c,o,r),f=Vt(Z(a));if(f===le)throw new Error("sign failed: k is zero");const{bytes:h,scalar:u}=Me(f),y=gr(h,o,r),m=new Uint8Array(64);if(m.set(h,0),m.set(He(Vt(u+y*i)),32),!yr(m,r,o))throw new Error("sign: Invalid signature produced");return m}function yr(t,e,n){const r=K("signature",t,64),o=K("message",e),i=K("publicKey",n,32);try{const s=pr(Z(i)),c=Z(r.subarray(0,32));if(!hr(c))return!1;const a=Z(r.subarray(32,64));if(!Ai(a))return!1;const f=gr(He(c),Xe(s),o),h=ki(s,a,Vt(-f));return!(!h||!h.hasEvenY()||h.toAffine().x!==c)}catch{return!1}}const Dt={getPublicKey:Bi,sign:Si,verify:yr,utils:{randomPrivateKey:Pt.utils.randomPrivateKey,lift_x:pr,pointToBytes:Xe,numberToBytesBE:xt,bytesToNumberBE:Z,taggedHash:ne,mod:z}},Se=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const tn=t=>t instanceof Uint8Array,Le=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),nt=(t,e)=>t<<32-e|t>>>e,Li=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Li)throw new Error("Non little-endian hardware is not supported");const _i=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function V(t){if(!tn(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=_i[t[n]];return e}function _t(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const o=r*2,i=t.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function Ii(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Ft(t){if(typeof t=="string"&&(t=Ii(t)),!tn(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function ue(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!tn(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class wr{clone(){return this._cloneInto()}}function br(t){const e=r=>t().update(Ft(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function mr(t=32){if(Se&&typeof Se.getRandomValues=="function")return Se.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Pe(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Ui(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function Er(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function $i(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Pe(t.outputLen),Pe(t.blockLen)}function Ci(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ti(t,e){Er(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ot={number:Pe,bool:Ui,bytes:Er,hash:$i,exists:Ci,output:Ti};function Ri(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,f=r?0:4;t.setUint32(e+a,s,r),t.setUint32(e+f,c,r)}class Ni extends wr{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Le(this.buffer)}update(e){ot.exists(this);const{view:n,buffer:r,blockLen:o}=this;e=Ft(e);const i=e.length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=Le(e);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(e.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ot.exists(this),ot.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let u=s;u<o;u++)n[u]=0;Ri(r,o-8,BigInt(this.length*8),i),this.process(r,0);const c=Le(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=a/4,h=this.get();if(f>h.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,h[u],i)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return e.length=o,e.pos=c,e.finished=i,e.destroyed=s,o%n&&e.buffer.set(r),e}}const Oi=(t,e,n)=>t&e^~t&n,Hi=(t,e,n)=>t&e^t&n^e&n,Mi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),bt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),mt=new Uint32Array(64);let vr=class extends Ni{constructor(){super(64,32,8,!1),this.A=bt[0]|0,this.B=bt[1]|0,this.C=bt[2]|0,this.D=bt[3]|0,this.E=bt[4]|0,this.F=bt[5]|0,this.G=bt[6]|0,this.H=bt[7]|0}get(){const{A:e,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[e,n,r,o,i,s,c,a]}set(e,n,r,o,i,s,c,a){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(e,n){for(let u=0;u<16;u++,n+=4)mt[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){const y=mt[u-15],m=mt[u-2],g=nt(y,7)^nt(y,18)^y>>>3,l=nt(m,17)^nt(m,19)^m>>>10;mt[u]=l+mt[u-7]+g+mt[u-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:f,H:h}=this;for(let u=0;u<64;u++){const y=nt(c,6)^nt(c,11)^nt(c,25),m=h+y+Oi(c,a,f)+Mi[u]+mt[u]|0,l=(nt(r,2)^nt(r,13)^nt(r,22))+Hi(r,o,i)|0;h=f,f=a,a=c,c=s+m|0,s=i,i=o,o=r,r=m+l|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,h=h+this.H|0,this.set(r,o,i,s,c,a,f,h)}roundClean(){mt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class Pi extends vr{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const qt=br(()=>new vr);br(()=>new Pi);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Wt(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function ut(...t){const e=(o,i)=>s=>o(i(s)),n=Array.from(t).reverse().reduce((o,i)=>o?e(o,i.encode):i.encode,void 0),r=t.reduce((o,i)=>o?e(o,i.decode):i.decode,void 0);return{encode:n,decode:r}}function ft(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(Wt(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function dt(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function fe(t,e="="){if(Wt(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function xr(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function Mn(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const o=[],i=Array.from(t);for(i.forEach(s=>{if(Wt(s),s<0||s>=e)throw new Error(`Wrong integer: ${s}`)});;){let s=0,c=!0;for(let a=r;a<i.length;a++){const f=i[a],h=e*s+f;if(!Number.isSafeInteger(h)||e*s/e!==s||h-f!==e*s)throw new Error("convertRadix: carry overflow");if(s=h%n,i[a]=Math.floor(h/n),!Number.isSafeInteger(i[a])||i[a]*n+s!==h)throw new Error("convertRadix: carry overflow");if(c)i[a]?c=!1:r=a;else continue}if(o.push(s),c)break}for(let s=0;s<t.length-1&&t[s]===0;s++)o.push(0);return o.reverse()}const Ar=(t,e)=>e?Ar(e,t%e):t,re=(t,e)=>t+(e-Ar(t,e));function qe(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(re(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${re(e,n)}`);let o=0,i=0;const s=2**n-1,c=[];for(const a of t){if(Wt(a),a>=2**e)throw new Error(`convertRadix2: invalid data word=${a} from=${e}`);if(o=o<<e|a,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=n;i-=n)c.push((o>>i-n&s)>>>0);o&=2**i-1}if(o=o<<n-i&s,!r&&i>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&i>0&&c.push(o>>>0),c}function qi(t){return Wt(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Mn(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Mn(e,t,2**8))}}}function At(t,e=!1){if(Wt(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(re(8,t)>32||re(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return qe(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(qe(n,t,8,e))}}}function Pn(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const Wi=ut(At(4),ft("0123456789ABCDEF"),dt("")),ji=ut(At(5),ft("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),fe(5),dt(""));ut(At(5),ft("0123456789ABCDEFGHIJKLMNOPQRSTUV"),fe(5),dt(""));ut(At(5),ft("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),dt(""),xr(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const lt=ut(At(6),ft("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),fe(6),dt("")),Di=ut(At(6),ft("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),fe(6),dt("")),en=t=>ut(qi(58),ft(t),dt("")),We=en("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");en("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");en("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const qn=[0,2,3,5,6,7,9,10,11],zi={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=We.encode(r).padStart(qn[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),o=qn.indexOf(r.length),i=We.decode(r);for(let s=0;s<i.length-o;s++)if(i[s]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(i.slice(i.length-o)))}return Uint8Array.from(e)}},je=ut(ft("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),dt("")),Wn=[996825010,642813549,513874426,1027748829,705979059];function zt(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<Wn.length;r++)(e>>r&1)===1&&(n^=Wn[r]);return n}function jn(t,e,n=1){const r=t.length;let o=1;for(let i=0;i<r;i++){const s=t.charCodeAt(i);if(s<33||s>126)throw new Error(`Invalid prefix (${t})`);o=zt(o)^s>>5}o=zt(o);for(let i=0;i<r;i++)o=zt(o)^t.charCodeAt(i)&31;for(let i of e)o=zt(o)^i;for(let i=0;i<6;i++)o=zt(o);return o^=n,je.encode(qe([o%2**30],30,5,!1))}function kr(t){const e=t==="bech32"?1:734539939,n=At(5),r=n.decode,o=n.encode,i=Pn(r);function s(h,u,y=90){if(typeof h!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof h}`);if(!Array.isArray(u)||u.length&&typeof u[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof u}`);const m=h.length+7+u.length;if(y!==!1&&m>y)throw new TypeError(`Length ${m} exceeds limit ${y}`);return h=h.toLowerCase(),`${h}1${je.encode(u)}${jn(h,u,e)}`}function c(h,u=90){if(typeof h!="string")throw new Error(`bech32.decode input should be string, not ${typeof h}`);if(h.length<8||u!==!1&&h.length>u)throw new TypeError(`Wrong string length: ${h.length} (${h}). Expected (8..${u})`);const y=h.toLowerCase();if(h!==y&&h!==h.toUpperCase())throw new Error("String must be lowercase or uppercase");h=y;const m=h.lastIndexOf("1");if(m===0||m===-1)throw new Error('Letter "1" must be present between prefix and data only');const g=h.slice(0,m),l=h.slice(m+1);if(l.length<6)throw new Error("Data must be at least 6 characters long");const d=je.decode(l).slice(0,-6),p=jn(g,d,e);if(!l.endsWith(p))throw new Error(`Invalid checksum in ${h}: expected "${p}"`);return{prefix:g,words:d}}const a=Pn(c);function f(h){const{prefix:u,words:y}=c(h,!1);return{prefix:u,words:y,bytes:r(y)}}return{encode:s,decode:c,decodeToBytes:f,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:i,toWords:o}}const Mt=kr("bech32");kr("bech32m");const Ki={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},Vi=ut(At(4),ft("0123456789abcdef"),dt(""),xr(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),Fi={utf8:Ki,hex:Vi,base16:Wi,base32:ji,base64:lt,base64url:Di,base58:We,base58xmr:zi};`${Object.keys(Fi).join(", ")}`;function _e(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function Dn(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Zi(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function at(t,...e){if(!Zi(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const F=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Gi=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Gi)throw new Error("Non little-endian hardware is not supported");function Ji(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Yi(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const Xi=(t,e)=>(Object.assign(e,t),e),vt=16,Qi=283;function nn(t){return t<<1^Qi&-(t>>7)}function Nt(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=nn(t);return n}const De=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=nn(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),ts=De.map((t,e)=>De.indexOf(e)),es=t=>t<<24|t>>>8,Ie=t=>t<<8|t>>>24;function Br(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((f,h)=>e(t[h])),r=n.map(Ie),o=r.map(Ie),i=o.map(Ie),s=new Uint32Array(256*256),c=new Uint32Array(256*256),a=new Uint16Array(256*256);for(let f=0;f<256;f++)for(let h=0;h<256;h++){const u=f*256+h;s[u]=n[f]^r[h],c[u]=o[f]^i[h],a[u]=t[f]<<8|t[h]}return{sbox:t,sbox2:a,T0:n,T1:r,T2:o,T3:i,T01:s,T23:c}}const rn=Br(De,t=>Nt(t,3)<<24|t<<16|t<<8|Nt(t,2)),Sr=Br(ts,t=>Nt(t,11)<<24|Nt(t,13)<<16|Nt(t,9)<<8|Nt(t,14)),ns=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=nn(n))t[e]=n;return t})();function Lr(t){at(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=rn,r=F(t),o=r.length,i=c=>it(n,c,c,c,c),s=new Uint32Array(e+28);s.set(r);for(let c=o;c<s.length;c++){let a=s[c-1];c%o===0?a=i(es(a))^ns[c/o-1]:o>6&&c%o===4&&(a=i(a)),s[c]=s[c-o]^a}return s}function rs(t){const e=Lr(t),n=e.slice(),r=e.length,{sbox2:o}=rn,{T0:i,T1:s,T2:c,T3:a}=Sr;for(let f=0;f<r;f+=4)for(let h=0;h<4;h++)n[f+h]=e[r-f-4+h];e.fill(0);for(let f=4;f<r-4;f++){const h=n[f],u=it(o,h,h,h,h);n[f]=i[u&255]^s[u>>>8&255]^c[u>>>16&255]^a[u>>>24]}return n}function Et(t,e,n,r,o,i){return t[n<<8&65280|r>>>8&255]^e[o>>>8&65280|i>>>24&255]}function it(t,e,n,r,o){return t[e&255|n&65280]|t[r>>>16&255|o>>>16&65280]<<16}function zn(t,e,n,r,o){const{sbox2:i,T01:s,T23:c}=rn;let a=0;e^=t[a++],n^=t[a++],r^=t[a++],o^=t[a++];const f=t.length/4-2;for(let g=0;g<f;g++){const l=t[a++]^Et(s,c,e,n,r,o),d=t[a++]^Et(s,c,n,r,o,e),p=t[a++]^Et(s,c,r,o,e,n),b=t[a++]^Et(s,c,o,e,n,r);e=l,n=d,r=p,o=b}const h=t[a++]^it(i,e,n,r,o),u=t[a++]^it(i,n,r,o,e),y=t[a++]^it(i,r,o,e,n),m=t[a++]^it(i,o,e,n,r);return{s0:h,s1:u,s2:y,s3:m}}function os(t,e,n,r,o){const{sbox2:i,T01:s,T23:c}=Sr;let a=0;e^=t[a++],n^=t[a++],r^=t[a++],o^=t[a++];const f=t.length/4-2;for(let g=0;g<f;g++){const l=t[a++]^Et(s,c,e,o,r,n),d=t[a++]^Et(s,c,n,e,o,r),p=t[a++]^Et(s,c,r,n,e,o),b=t[a++]^Et(s,c,o,r,n,e);e=l,n=d,r=p,o=b}const h=t[a++]^it(i,e,o,r,n),u=t[a++]^it(i,n,e,o,r),y=t[a++]^it(i,r,n,e,o),m=t[a++]^it(i,o,r,n,e);return{s0:h,s1:u,s2:y,s3:m}}function _r(t,e){if(!e)return new Uint8Array(t);if(at(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function is(t){if(at(t),t.length%vt!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${vt}`)}function ss(t,e,n){let r=t.length;const o=r%vt;if(!e&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const i=F(t);if(e){let a=vt-o;a||(a=vt),r=r+a}const s=_r(r,n),c=F(s);return{b:i,o:c,out:s}}function as(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const o=t.subarray(0,-r);for(let i=0;i<r;i++)if(t[n-i-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function cs(t){const e=new Uint8Array(16),n=F(e);e.set(t);const r=vt-t.length;for(let o=vt-r;o<vt;o++)e[o]=r;return n}const Ir=Xi({blockSize:16,nonceLength:16},function(e,n,r={}){at(e),at(n,16);const o=!r.disablePadding;return{encrypt:(i,s)=>{const c=Lr(e),{b:a,o:f,out:h}=ss(i,o,s),u=F(n);let y=u[0],m=u[1],g=u[2],l=u[3],d=0;for(;d+4<=a.length;)y^=a[d+0],m^=a[d+1],g^=a[d+2],l^=a[d+3],{s0:y,s1:m,s2:g,s3:l}=zn(c,y,m,g,l),f[d++]=y,f[d++]=m,f[d++]=g,f[d++]=l;if(o){const p=cs(i.subarray(d*4));y^=p[0],m^=p[1],g^=p[2],l^=p[3],{s0:y,s1:m,s2:g,s3:l}=zn(c,y,m,g,l),f[d++]=y,f[d++]=m,f[d++]=g,f[d++]=l}return c.fill(0),h},decrypt:(i,s)=>{is(i);const c=rs(e),a=F(n),f=_r(i.length,s),h=F(i),u=F(f);let y=a[0],m=a[1],g=a[2],l=a[3];for(let d=0;d+4<=h.length;){const p=y,b=m,v=g,L=l;y=h[d+0],m=h[d+1],g=h[d+2],l=h[d+3];const{s0:_,s1:x,s2:k,s3:A}=os(c,y,m,g,l);u[d++]=_^p,u[d++]=x^b,u[d++]=k^v,u[d++]=A^L}return c.fill(0),as(f,o)}}}),Ur=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),ls=Ur("expand 16-byte k"),us=Ur("expand 32-byte k"),fs=F(ls),$r=F(us);$r.slice();function R(t,e){return t<<e|t>>>32-e}function ze(t){return t.byteOffset%4===0}const Jt=64,ds=16,Cr=2**32-1,Kn=new Uint32Array;function hs(t,e,n,r,o,i,s,c){const a=o.length,f=new Uint8Array(Jt),h=F(f),u=ze(o)&&ze(i),y=u?F(o):Kn,m=u?F(i):Kn;for(let g=0;g<a;s++){if(t(e,n,r,h,s,c),s>=Cr)throw new Error("arx: counter overflow");const l=Math.min(Jt,a-g);if(u&&l===Jt){const d=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let p=0,b;p<ds;p++)b=d+p,m[b]=y[b]^h[p];g+=Jt;continue}for(let d=0,p;d<l;d++)p=g+d,i[p]=o[p]^f[d];g+=l}}function ps(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:i,rounds:s}=Ji({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return _e(o),_e(s),Dn(i),Dn(n),(c,a,f,h,u=0)=>{at(c),at(a),at(f);const y=f.length;if(h||(h=new Uint8Array(y)),at(h),_e(u),u<0||u>=Cr)throw new Error("arx: counter overflow");if(h.length<y)throw new Error(`arx: output (${h.length}) is shorter than data (${y})`);const m=[];let g=c.length,l,d;if(g===32)l=c.slice(),m.push(l),d=$r;else if(g===16&&n)l=new Uint8Array(32),l.set(c),l.set(c,16),d=fs,m.push(l);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);ze(a)||(a=a.slice(),m.push(a));const p=F(l);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(d,p,F(a.subarray(0,16)),p),a=a.subarray(16)}const b=16-o;if(b!==a.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const L=new Uint8Array(12);L.set(a,i?0:12-a.length),a=L,m.push(a)}const v=F(a);for(hs(t,d,p,v,f,h,u,s);m.length>0;)m.pop().fill(0);return h}}function gs(t,e,n,r,o,i=20){let s=t[0],c=t[1],a=t[2],f=t[3],h=e[0],u=e[1],y=e[2],m=e[3],g=e[4],l=e[5],d=e[6],p=e[7],b=o,v=n[0],L=n[1],_=n[2],x=s,k=c,A=a,$=f,I=h,S=u,O=y,H=m,W=g,w=l,E=d,B=p,C=b,U=v,T=L,M=_;for(let Y=0;Y<i;Y+=2)x=x+I|0,C=R(C^x,16),W=W+C|0,I=R(I^W,12),x=x+I|0,C=R(C^x,8),W=W+C|0,I=R(I^W,7),k=k+S|0,U=R(U^k,16),w=w+U|0,S=R(S^w,12),k=k+S|0,U=R(U^k,8),w=w+U|0,S=R(S^w,7),A=A+O|0,T=R(T^A,16),E=E+T|0,O=R(O^E,12),A=A+O|0,T=R(T^A,8),E=E+T|0,O=R(O^E,7),$=$+H|0,M=R(M^$,16),B=B+M|0,H=R(H^B,12),$=$+H|0,M=R(M^$,8),B=B+M|0,H=R(H^B,7),x=x+S|0,M=R(M^x,16),E=E+M|0,S=R(S^E,12),x=x+S|0,M=R(M^x,8),E=E+M|0,S=R(S^E,7),k=k+O|0,C=R(C^k,16),B=B+C|0,O=R(O^B,12),k=k+O|0,C=R(C^k,8),B=B+C|0,O=R(O^B,7),A=A+H|0,U=R(U^A,16),W=W+U|0,H=R(H^W,12),A=A+H|0,U=R(U^A,8),W=W+U|0,H=R(H^W,7),$=$+I|0,T=R(T^$,16),w=w+T|0,I=R(I^w,12),$=$+I|0,T=R(T^$,8),w=w+T|0,I=R(I^w,7);let N=0;r[N++]=s+x|0,r[N++]=c+k|0,r[N++]=a+A|0,r[N++]=f+$|0,r[N++]=h+I|0,r[N++]=u+S|0,r[N++]=y+O|0,r[N++]=m+H|0,r[N++]=g+W|0,r[N++]=l+w|0,r[N++]=d+E|0,r[N++]=p+B|0,r[N++]=b+C|0,r[N++]=v+U|0,r[N++]=L+T|0,r[N++]=_+M|0}const Tr=ps(gs,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Rr extends wr{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,ot.hash(e);const r=Ft(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?e.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(e){return ot.exists(this),this.iHash.update(e),this}digestInto(e){ot.exists(this),ot.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=c,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const de=(t,e,n)=>new Rr(t,e).update(n).digest();de.create=(t,e)=>new Rr(t,e);function ys(t,e,n){return ot.hash(t),de(t,Ft(n),Ft(e))}const Ue=new Uint8Array([0]),Vn=new Uint8Array;function ws(t,e,n,r=32){if(ot.hash(t),ot.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/t.outputLen);n===void 0&&(n=Vn);const i=new Uint8Array(o*t.outputLen),s=de.create(t,e),c=s._cloneInto(),a=new Uint8Array(s.outputLen);for(let f=0;f<o;f++)Ue[0]=f+1,c.update(f===0?Vn:a).update(n).update(Ue).digestInto(a),i.set(a,t.outputLen*f),s._cloneInto(c);return s.destroy(),c.destroy(),a.fill(0),Ue.fill(0),i.slice(0,r)}var bs=Object.defineProperty,q=(t,e)=>{for(var n in e)bs(t,n,{get:e[n],enumerable:!0})},Rt=Symbol("verified"),ms=t=>t instanceof Object;function on(t){if(!ms(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var Es={};q(Es,{Queue:()=>ks,QueueNode:()=>Nr,binarySearch:()=>sn,bytesToHex:()=>V,hexToBytes:()=>_t,insertEventIntoAscendingList:()=>As,insertEventIntoDescendingList:()=>xs,normalizeURL:()=>vs,utf8Decoder:()=>ct,utf8Encoder:()=>Q});var ct=new TextDecoder("utf-8"),Q=new TextEncoder;function vs(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function xs(t,e){const[n,r]=sn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:o.created_at-e.created_at);return r||t.splice(n,0,e),t}function As(t,e){const[n,r]=sn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:e.created_at-o.created_at);return r||t.splice(n,0,e),t}function sn(t,e){let n=0,r=t.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),i=e(t[o]);if(i===0)return[o,!0];i<0?r=o-1:n=o+1}return[n,!1]}var Nr=class{constructor(t){gt(this,"value");gt(this,"next",null);gt(this,"prev",null);this.value=t}},ks=class{constructor(){gt(this,"first");gt(this,"last");this.first=null,this.last=null}enqueue(t){const e=new Nr(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},Bs=class{generateSecretKey(){return Dt.utils.randomPrivateKey()}getPublicKey(t){return V(Dt.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=V(Dt.getPublicKey(e)),n.id=Xt(n),n.sig=V(Dt.sign(Xt(n),e)),n[Rt]=!0,n}verifyEvent(t){if(typeof t[Rt]=="boolean")return t[Rt];const e=Xt(t);if(e!==t.id)return t[Rt]=!1,!1;try{const n=Dt.verify(t.sig,e,t.pubkey);return t[Rt]=n,n}catch{return t[Rt]=!1,!1}}};function Ss(t){if(!on(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Xt(t){let e=qt(Q.encode(Ss(t)));return V(e)}var he=new Bs,Or=he.generateSecretKey,pe=he.getPublicKey,tt=he.finalizeEvent,ge=he.verifyEvent,Ls={};q(Ls,{Application:()=>Sa,BadgeAward:()=>Ns,BadgeDefinition:()=>ma,BlockedRelaysList:()=>ra,BookmarkList:()=>ta,Bookmarksets:()=>ya,Calendar:()=>Ta,CalendarEventRSVP:()=>Ra,ChannelCreation:()=>jr,ChannelHideMessage:()=>Kr,ChannelMessage:()=>zr,ChannelMetadata:()=>Dr,ChannelMuteUser:()=>Vr,ClassifiedListing:()=>Ia,ClientAuth:()=>Zr,CommunitiesList:()=>ea,CommunityDefinition:()=>Ha,CommunityPostApproval:()=>Ds,Contacts:()=>Cs,CreateOrUpdateProduct:()=>xa,CreateOrUpdateStall:()=>va,Curationsets:()=>wa,Date:()=>$a,DirectMessageRelaysList:()=>aa,DraftClassifiedListing:()=>Ua,DraftLong:()=>ka,Emojisets:()=>Ba,EncryptedDirectMessage:()=>Ts,EventDeletion:()=>Rs,FileMetadata:()=>Hs,FileServerPreference:()=>ca,Followsets:()=>ha,GenericRepost:()=>fn,Genericlists:()=>pa,GiftWrap:()=>Fr,HTTPAuth:()=>dn,Handlerinformation:()=>Oa,Handlerrecommendation:()=>Na,Highlights:()=>Js,InterestsList:()=>ia,Interestsets:()=>Ea,JobFeedback:()=>Vs,JobRequest:()=>zs,JobResult:()=>Ks,Label:()=>js,LightningPubRPC:()=>ua,LiveChatMessage:()=>Ms,LiveEvent:()=>La,LongFormArticle:()=>Aa,Metadata:()=>Us,Mutelist:()=>Ys,NWCWalletInfo:()=>la,NWCWalletRequest:()=>Gr,NWCWalletResponse:()=>fa,NostrConnect:()=>da,OpenTimestamps:()=>Os,Pinlist:()=>Xs,PrivateDirectMessage:()=>Wr,ProblemTracker:()=>Ps,ProfileBadges:()=>ba,PublicChatsList:()=>na,Reaction:()=>un,RecommendRelay:()=>$s,RelayList:()=>Qs,Relaysets:()=>ga,Report:()=>qs,Reporting:()=>Ws,Repost:()=>ln,Seal:()=>qr,SearchRelaysList:()=>oa,ShortTextNote:()=>Pr,Time:()=>Ca,UserEmojiList:()=>sa,UserStatuses:()=>_a,Zap:()=>Gs,ZapGoal:()=>Fs,ZapRequest:()=>Zs,classifyKind:()=>_s,isAddressableKind:()=>cn,isEphemeralKind:()=>Mr,isKind:()=>Is,isRegularKind:()=>Hr,isReplaceableKind:()=>an});function Hr(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function an(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function Mr(t){return 2e4<=t&&t<3e4}function cn(t){return 3e4<=t&&t<4e4}function _s(t){return Hr(t)?"regular":an(t)?"replaceable":Mr(t)?"ephemeral":cn(t)?"parameterized":"unknown"}function Is(t,e){const n=e instanceof Array?e:[e];return on(t)&&n.includes(t.kind)||!1}var Us=0,Pr=1,$s=2,Cs=3,Ts=4,Rs=5,ln=6,un=7,Ns=8,qr=13,Wr=14,fn=16,jr=40,Dr=41,zr=42,Kr=43,Vr=44,Os=1040,Fr=1059,Hs=1063,Ms=1311,Ps=1971,qs=1984,Ws=1984,js=1985,Ds=4550,zs=5999,Ks=6999,Vs=7e3,Fs=9041,Zs=9734,Gs=9735,Js=9802,Ys=1e4,Xs=10001,Qs=10002,ta=10003,ea=10004,na=10005,ra=10006,oa=10007,ia=10015,sa=10030,aa=10050,ca=10096,la=13194,ua=21e3,Zr=22242,Gr=23194,fa=23195,da=24133,dn=27235,ha=3e4,pa=30001,ga=30002,ya=30003,wa=30004,ba=30008,ma=30009,Ea=30015,va=30017,xa=30018,Aa=30023,ka=30024,Ba=30030,Sa=30078,La=30311,_a=30315,Ia=30402,Ua=30403,$a=31922,Ca=31923,Ta=31924,Ra=31925,Na=31989,Oa=31990,Ha=34550,Ma={};q(Ma,{getHex64:()=>hn,getInt:()=>Jr,getSubscriptionId:()=>Pa,matchEventId:()=>qa,matchEventKind:()=>ja,matchEventPubkey:()=>Wa});function hn(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,o=t.slice(r).indexOf('"')+r+1;return t.slice(o,o+64)}function Jr(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,o=t.slice(r),i=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,i),10)}function Pa(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,o=t.slice(r+1,80).indexOf('"');if(o===-1)return null;let i=r+1+o;return t.slice(r+1,i)}function qa(t,e){return e===hn(t,"id")}function Wa(t,e){return e===hn(t,"pubkey")}function ja(t,e){return e===Jr(t,"kind")}var Da={};q(Da,{makeAuthEvent:()=>za});function za(t,e){return{kind:Zr,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var Ka;try{Ka=WebSocket}catch{}var Va;try{Va=WebSocket}catch{}var Zt={};q(Zt,{BECH32_REGEX:()=>Yr,Bech32MaxSize:()=>pn,NostrTypeGuard:()=>Fa,decode:()=>ye,decodeNostrURI:()=>Ga,encodeBytes:()=>be,naddrEncode:()=>ec,neventEncode:()=>tc,noteEncode:()=>Xa,nprofileEncode:()=>Qa,npubEncode:()=>Ya,nsecEncode:()=>Ja});var Fa={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},pn=5e3,Yr=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Za(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function Ga(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),ye(t)}catch{return{type:"invalid",data:null}}}function ye(t){var o,i,s,c,a,f,h;let{prefix:e,words:n}=Mt.decode(t,pn),r=new Uint8Array(Mt.fromWords(n));switch(e){case"nprofile":{let u=$e(r);if(!((o=u[0])!=null&&o[0]))throw new Error("missing TLV 0 for nprofile");if(u[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:V(u[0][0]),relays:u[1]?u[1].map(y=>ct.decode(y)):[]}}}case"nevent":{let u=$e(r);if(!((i=u[0])!=null&&i[0]))throw new Error("missing TLV 0 for nevent");if(u[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(u[2]&&u[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(u[3]&&u[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:V(u[0][0]),relays:u[1]?u[1].map(y=>ct.decode(y)):[],author:(s=u[2])!=null&&s[0]?V(u[2][0]):void 0,kind:(c=u[3])!=null&&c[0]?parseInt(V(u[3][0]),16):void 0}}}case"naddr":{let u=$e(r);if(!((a=u[0])!=null&&a[0]))throw new Error("missing TLV 0 for naddr");if(!((f=u[2])!=null&&f[0]))throw new Error("missing TLV 2 for naddr");if(u[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((h=u[3])!=null&&h[0]))throw new Error("missing TLV 3 for naddr");if(u[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:ct.decode(u[0][0]),pubkey:V(u[2][0]),kind:parseInt(V(u[3][0]),16),relays:u[1]?u[1].map(y=>ct.decode(y)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:V(r)};default:throw new Error(`unknown prefix ${e}`)}}function $e(t){let e={},n=t;for(;n.length>0;){let r=n[0],o=n[1],i=n.slice(2,2+o);if(n=n.slice(2+o),i.length<o)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(i)}return e}function Ja(t){return be("nsec",t)}function Ya(t){return be("npub",_t(t))}function Xa(t){return be("note",_t(t))}function we(t,e){let n=Mt.toWords(e);return Mt.encode(t,n,pn)}function be(t,e){return we(t,e)}function Qa(t){let e=gn({0:[_t(t.pubkey)],1:(t.relays||[]).map(n=>Q.encode(n))});return we("nprofile",e)}function tc(t){let e;t.kind!==void 0&&(e=Za(t.kind));let n=gn({0:[_t(t.id)],1:(t.relays||[]).map(r=>Q.encode(r)),2:t.author?[_t(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return we("nevent",n)}function ec(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=gn({0:[Q.encode(t.identifier)],1:(t.relays||[]).map(r=>Q.encode(r)),2:[_t(t.pubkey)],3:[new Uint8Array(e)]});return we("naddr",n)}function gn(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(o=>{let i=new Uint8Array(o.length+2);i.set([parseInt(n)],0),i.set([o.length],1),i.set(o,2),e.push(i)})}),ue(...e)}var nc={};q(nc,{decrypt:()=>rc,encrypt:()=>Xr});function Xr(t,e,n){const r=t instanceof Uint8Array?V(t):t,o=Pt.getSharedSecret(r,"02"+e),i=Qr(o);let s=Uint8Array.from(mr(16)),c=Q.encode(n),a=Ir(i,s).encrypt(c),f=lt.encode(new Uint8Array(a)),h=lt.encode(new Uint8Array(s.buffer));return`${f}?iv=${h}`}function rc(t,e,n){const r=t instanceof Uint8Array?V(t):t;let[o,i]=n.split("?iv="),s=Pt.getSharedSecret(r,"02"+e),c=Qr(s),a=lt.decode(i),f=lt.decode(o),h=Ir(c,a).decrypt(f);return ct.decode(h)}function Qr(t){return t.slice(1,33)}var oc={};q(oc,{NIP05_REGEX:()=>yn,isNip05:()=>ic,isValid:()=>cc,queryProfile:()=>to,searchDomain:()=>ac,useFetchImplementation:()=>sc});var yn=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,ic=t=>yn.test(t||""),me;try{me=fetch}catch{}function sc(t){me=t}async function ac(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await me(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function to(t){var o;const e=t.match(yn);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await me(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const c=await s.json(),a=c.names[n];return a?{pubkey:a,relays:(o=c.relays)==null?void 0:o[a]}:null}catch{return null}}async function cc(t,e){const n=await to(e);return n?n.pubkey===t:!1}var lc={};q(lc,{parse:()=>uc});function uc(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let o=t.tags.length-1;o>=0;o--){const i=t.tags[o];if(i[0]==="e"&&i[1]){const[s,c,a,f,h]=i,u={id:c,relays:a?[a]:[],author:h};if(f==="root"){e.root=u;continue}if(f==="reply"){e.reply=u;continue}if(f==="mention"){e.mentions.push(u);continue}n?r=u:n=u,e.mentions.push(u);continue}if(i[0]==="q"&&i[1]){const[s,c,a]=i;e.quotes.push({id:c,relays:a?[a]:[]})}if(i[0]==="p"&&i[1]){e.profiles.push({pubkey:i[1],relays:i[2]?[i[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(o=>{if(!o)return;let i=e.mentions.indexOf(o);if(i!==-1&&e.mentions.splice(i,1),o.author){let s=e.profiles.find(c=>c.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(c=>{var a;((a=o.relays)==null?void 0:a.indexOf(c))===-1&&o.relays.push(c)}),s.relays=o.relays)}}),e.mentions.forEach(o=>{if(o.author){let i=e.profiles.find(s=>s.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(s=>{o.relays.indexOf(s)===-1&&o.relays.push(s)}),i.relays=o.relays)}}),e}var fc={};q(fc,{fetchRelayInformation:()=>hc,useFetchImplementation:()=>dc});var eo;try{eo=fetch}catch{}function dc(t){eo=t}async function hc(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var pc={};q(pc,{fastEventHash:()=>ro,getPow:()=>no,minePow:()=>gc});function no(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function gc(t,e){let n=0;const r=t,o=["nonce",n.toString(),e.toString()];for(r.tags.push(o);;){const i=Math.floor(new Date().getTime()/1e3);if(i!==r.created_at&&(n=0,r.created_at=i),o[1]=(++n).toString(),r.id=ro(r),no(r.id)>=e)break}return r}function ro(t){return V(qt(Q.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var yc={};q(yc,{unwrapEvent:()=>_c,unwrapManyEvents:()=>Ic,wrapEvent:()=>wo,wrapManyEvents:()=>Lc});var wc={};q(wc,{createRumor:()=>ho,createSeal:()=>po,createWrap:()=>go,unwrapEvent:()=>vn,unwrapManyEvents:()=>yo,wrapEvent:()=>oe,wrapManyEvents:()=>Bc});var bc={};q(bc,{decrypt:()=>En,encrypt:()=>mn,getConversationKey:()=>wn,v2:()=>Ac});var oo=1,io=65535;function wn(t,e){const n=Pt.getSharedSecret(t,"02"+e).subarray(1,33);return ys(qt,n,"nip44-v2")}function so(t,e){const n=ws(qt,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function bn(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function mc(t){if(!Number.isSafeInteger(t)||t<oo||t>io)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function Ec(t){const e=Q.encode(t),n=e.length,r=mc(n),o=new Uint8Array(bn(n)-n);return ue(r,e,o)}function vc(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<oo||e>io||n.length!==e||t.length!==2+bn(e))throw new Error("invalid padding");return ct.decode(n)}function ao(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=ue(n,e);return de(qt,t,r)}function xc(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=lt.decode(t)}catch(i){throw new Error("invalid base64: "+i.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function mn(t,e,n=mr(32)){const{chacha_key:r,chacha_nonce:o,hmac_key:i}=so(e,n),s=Ec(t),c=Tr(r,o,s),a=ao(i,c,n);return lt.encode(ue(new Uint8Array([2]),n,c,a))}function En(t,e){const{nonce:n,ciphertext:r,mac:o}=xc(t),{chacha_key:i,chacha_nonce:s,hmac_key:c}=so(e,n),a=ao(c,r,n);if(!Yi(a,o))throw new Error("invalid MAC");const f=Tr(i,s,r);return vc(f)}var Ac={utils:{getConversationKey:wn,calcPaddedLen:bn},encrypt:mn,decrypt:En},kc=2*24*60*60,co=()=>Math.round(Date.now()/1e3),lo=()=>Math.round(co()-Math.random()*kc),uo=(t,e)=>wn(t,e),fo=(t,e,n)=>mn(JSON.stringify(t),uo(e,n)),Fn=(t,e)=>JSON.parse(En(t.content,uo(e,t.pubkey)));function ho(t,e){const n={created_at:co(),content:"",tags:[],...t,pubkey:pe(e)};return n.id=Xt(n),n}function po(t,e,n){return tt({kind:qr,content:fo(t,e,n),created_at:lo(),tags:[]},e)}function go(t,e){const n=Or();return tt({kind:Fr,content:fo(t,n,e),created_at:lo(),tags:[["p",e]]},n)}function oe(t,e,n){const r=ho(t,e),o=po(r,e,n);return go(o,n)}function Bc(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=pe(e),o=[oe(t,e,r)];return n.forEach(i=>{o.push(oe(t,e,i))}),o}function vn(t,e){const n=Fn(t,e);return Fn(n,e)}function yo(t,e){let n=[];return t.forEach(r=>{n.push(vn(r,e))}),n.sort((r,o)=>r.created_at-o.created_at),n}function Sc(t,e,n,r){const o={created_at:Math.ceil(Date.now()/1e3),kind:Wr,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:s,relayUrl:c})=>{o.tags.push(c?["p",s,c]:["p",s])}),r&&o.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function wo(t,e,n,r,o){const i=Sc(e,n,r,o);return oe(i,t,e.publicKey)}function Lc(t,e,n,r,o){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:pe(t)},...e].map(s=>wo(t,s,n,r,o))}var _c=vn,Ic=yo,Uc={};q(Uc,{finishRepostEvent:()=>$c,getRepostedEvent:()=>Cc,getRepostedEventPointer:()=>bo});function $c(t,e,n,r){var s;let o;const i=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===Pr?o=ln:(o=fn,i.push(["k",String(e.kind)])),tt({kind:o,tags:i,content:t.content===""||(s=e.tags)!=null&&s.find(c=>c[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function bo(t){if(![ln,fn].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(e!==void 0)return{id:e[1],relays:[e[2],n==null?void 0:n[2]].filter(r=>typeof r=="string"),author:n==null?void 0:n[1]}}function Cc(t,{skipVerification:e}={}){const n=bo(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!ge(r)))return r}var Tc={};q(Tc,{NOSTR_URI_REGEX:()=>xn,parse:()=>Nc,test:()=>Rc});var xn=new RegExp(`nostr:(${Yr.source})`);function Rc(t){return typeof t=="string"&&new RegExp(`^${xn.source}$`).test(t)}function Nc(t){const e=t.match(new RegExp(`^${xn.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:ye(e[1])}}var Oc={};q(Oc,{finishReactionEvent:()=>Hc,getReactedEventPointer:()=>Mc});function Hc(t,e,n){const r=e.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return tt({...t,kind:un,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function Mc(t){if(t.kind!==un)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Pc={};q(Pc,{parse:()=>Wc});var qc=/\W/m,Zn=/\W |\W$|$|,| /m;function*Wc(t){const e=t.length;let n=0,r=0;for(;r<e;){let o=t.indexOf(":",r);if(o===-1)break;if(t.substring(o-5,o)==="nostr"){const i=t.substring(o+60).match(qc),s=i?o+60+i.index:e;try{let c,{data:a,type:f}=ye(t.substring(o+1,s));switch(f){case"npub":c={pubkey:a};break;case"nsec":case"note":r=s+1;continue;default:c=a}n!==o-5&&(yield{type:"text",text:t.substring(n,o-5)}),yield{type:"reference",pointer:c},r=s,n=r;continue}catch{r=o+1;continue}}else if(t.substring(o-5,o)==="https"||t.substring(o-4,o)==="http"){const i=t.substring(o+4).match(Zn),s=i?o+4+i.index:e,c=t[o-1]==="s"?5:4;try{let a=new URL(t.substring(o-c,s));if(a.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==o-c&&(yield{type:"text",text:t.substring(n,o-c)}),a.pathname.endsWith(".png")||a.pathname.endsWith(".jpg")||a.pathname.endsWith(".jpeg")||a.pathname.endsWith(".gif")||a.pathname.endsWith(".webp")){yield{type:"image",url:a.toString()},r=s,n=r;continue}if(a.pathname.endsWith(".mp4")||a.pathname.endsWith(".avi")||a.pathname.endsWith(".webm")||a.pathname.endsWith(".mkv")){yield{type:"video",url:a.toString()},r=s,n=r;continue}if(a.pathname.endsWith(".mp3")||a.pathname.endsWith(".aac")||a.pathname.endsWith(".ogg")||a.pathname.endsWith(".opus")){yield{type:"audio",url:a.toString()},r=s,n=r;continue}yield{type:"url",url:a.toString()},r=s,n=r;continue}catch{r=s+1;continue}}else if(t.substring(o-3,o)==="wss"||t.substring(o-2,o)==="ws"){const i=t.substring(o+4).match(Zn),s=i?o+4+i.index:e,c=t[o-1]==="s"?3:2;try{let a=new URL(t.substring(o-c,s));if(a.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==o-c&&(yield{type:"text",text:t.substring(n,o-c)}),yield{type:"relay",url:a.toString()},r=s,n=r;continue}catch{r=s+1;continue}}else{r=o+1;continue}}n!==e&&(yield{type:"text",text:t.substring(n)})}var jc={};q(jc,{channelCreateEvent:()=>Dc,channelHideMessageEvent:()=>Vc,channelMessageEvent:()=>Kc,channelMetadataEvent:()=>zc,channelMuteUserEvent:()=>Fc});var Dc=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return tt({kind:jr,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},zc=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return tt({kind:Dr,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Kc=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),tt({kind:zr,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},Vc=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return tt({kind:Kr,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Fc=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return tt({kind:Vr,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},Zc={};q(Zc,{EMOJI_SHORTCODE_REGEX:()=>mo,matchAll:()=>Gc,regex:()=>An,replaceAll:()=>Jc});var mo=/:(\w+):/,An=()=>new RegExp(`\\B${mo.source}\\B`,"g");function*Gc(t){const e=t.matchAll(An());for(const n of e)try{const[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function Jc(t,e){return t.replaceAll(An(),(n,r)=>e({shortcode:n,name:r}))}var Yc={};q(Yc,{useFetchImplementation:()=>Xc,validateGithub:()=>Qc});var kn;try{kn=fetch}catch{}function Xc(t){kn=t}async function Qc(t,e,n){try{return await(await kn(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var tl={};q(tl,{makeNwcRequestEvent:()=>nl,parseConnectionString:()=>el});function el(t){const{host:e,pathname:n,searchParams:r}=new URL(t),o=n||e,i=r.get("relay"),s=r.get("secret");if(!o||!i||!s)throw new Error("invalid connection string");return{pubkey:o,relay:i,secret:s}}async function nl(t,e,n){const o=Xr(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),i={kind:Gr,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t]]};return tt(i,e)}var rl={};q(rl,{normalizeIdentifier:()=>ol});function ol(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var il={};q(il,{getSatoshisAmountFromBolt11:()=>fl,getZapEndpoint:()=>al,makeZapReceipt:()=>ul,makeZapRequest:()=>cl,useFetchImplementation:()=>sl,validateZapRequest:()=>ll});var Bn;try{Bn=fetch}catch{}function sl(t){Bn=t}async function al(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:s}=Mt.decode(n,1e3),c=Mt.fromWords(s);e=ct.decode(c)}else if(r){let[s,c]=r.split("@");e=new URL(`/.well-known/lnurlp/${s}`,`https://${c}`).toString()}else return null;let i=await(await Bn(e)).json();if(i.allowsNostr&&i.nostrPubkey)return i.callback}catch{}return null}function cl(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(an(t.event.kind)){const n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(cn(t.event.kind)){let n=t.event.tags.find(([o,i])=>o==="d"&&i);if(!n)throw new Error("d tag not found or is empty");const r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function ll(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!on(e))return"Zap request is not a valid Nostr event.";if(!ge(e))return"Invalid signature on zap request.";let n=e.tags.find(([i,s])=>i==="p"&&s);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([i,s])=>i==="e"&&s);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([i,s])=>i==="relays"&&s)?null:"Zap request doesn't have a 'relays' tag."}function ul({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let o=JSON.parse(t),i=o.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),s={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...i,["P",o.pubkey],["bolt11",n],["description",t]]};return e&&s.tags.push(["preimage",e]),s}function fl(t){if(t.length<50)return 0;t=t.substring(0,50);const e=t.lastIndexOf("1");if(e===-1)return 0;const n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const o=r[r.length-1],i=o.charCodeAt(0)-48,s=i>=0&&i<=9;let c=r.length-1;if(s&&c++,c<1)return 0;const a=parseInt(r.substring(0,c));switch(o){case"m":return a*1e5;case"u":return a*100;case"n":return a/10;case"p":return a/1e4;default:return a*1e8}}var dl={};q(dl,{getToken:()=>hl,hashPayload:()=>Sn,unpackEventFromToken:()=>vo,validateEvent:()=>Lo,validateEventKind:()=>Ao,validateEventMethodTag:()=>Bo,validateEventPayloadTag:()=>So,validateEventTimestamp:()=>xo,validateEventUrlTag:()=>ko,validateToken:()=>pl});var Eo="Nostr ";async function hl(t,e,n,r=!1,o){const i={kind:dn,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&i.tags.push(["payload",Sn(o)]);const s=await n(i);return(r?Eo:"")+lt.encode(Q.encode(JSON.stringify(s)))}async function pl(t,e,n){const r=await vo(t).catch(i=>{throw i});return await Lo(r,e,n).catch(i=>{throw i})}async function vo(t){if(!t)throw new Error("Missing token");t=t.replace(Eo,"");const e=ct.decode(lt.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function xo(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function Ao(t){return t.kind===dn}function ko(t,e){const n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function Bo(t,e){const n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function Sn(t){const e=qt(Q.encode(JSON.stringify(t)));return V(e)}function So(t,e){const n=t.tags.find(o=>o[0]==="payload");if(!n)return!1;const r=Sn(e);return n.length>0&&n[1]===r}async function Lo(t,e,n,r){if(!ge(t))throw new Error("Invalid nostr event, signature invalid");if(!Ao(t))throw new Error("Invalid nostr event, kind invalid");if(!xo(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!ko(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!Bo(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!So(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function gl(t="token"){try{return ie.keyFromNsec(localStorage.getItem(t))}catch{const e=ie.randomKey();return localStorage.setItem(t,e.sec),e}}const ie={keyFromNsec:t=>({pub:yl(t),sec:t,sign:e=>_o(e,t)}),randomKey:()=>{const t=Zt.nsecEncode(Or());return ie.keyFromNsec(t)},checkEvent:t=>ge(t)},Kt=ie.keyFromNsec("nsec1qp3y43jmsdr665dc2gxmaxm6e5pqtyhqdr3zsfa902j2vr3tcpysrwnux0");function yl(t){const e=Zt.decode(t);if(e.type!=="nsec")throw new Error("Invalid secret key");const n=Zt.npubEncode(pe(e.data));if(n.startsWith("npub1"))return n;throw new Error("Invalid public key")}const _o=(t,e)=>{let n={kind:1,tags:[],content:t,created_at:Math.floor(Date.now()/1e3)};return tt(n,Zt.decode(e).data)},P=(t,e,n="",r)=>{const o=document.createElement(t);return o.innerText=e,n&&o.classList.add(...n.split(".").filter(i=>i)),r&&Object.entries(r).forEach(([i,s])=>{i==="parent"&&s.appendChild(o),i==="children"?s.forEach(c=>o.appendChild(c)):i==="eventListeners"?Object.entries(s).forEach(([c,a])=>{o.addEventListener(c,a)}):i==="color"||i==="background"?o.style[i]=s:o[i]=s}),o},Gn=t=>{const e=P("div","","popup-background");return e.appendChild(t),document.body.appendChild(e),e.onclick=()=>{e.remove()},t.classList.add("popup-dialog"),e.appendChild(P("div","close","popup-close",{onclick:()=>{e.remove()}})),t.onclick=n=>{n.stopPropagation()},()=>e.remove()};class Jn{constructor(e){gt(this,"value");gt(this,"listeners",[]);this.value=e}get(){return this.value}set(e,n=!1){if(!(!n&&e===this.value)){for(const r of this.listeners)r(e);this.value=e}}update(e,n=!1){const r=e(this.value);this.set(r,n)}subscribe(e){this.listeners.push(e),e(this.value)}subscribeLater(e){this.listeners.push(e)}}const Io=async t=>{const e=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t));return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")};async function Yn(t,e,n){async function r(i){const s=_o(JSON.stringify(i),n.sec),c=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(c.ok)return JSON.parse(await c.json());throw new Error("Failed to send request:"+c.status)}const o=await bl(e);return await r({pubkey:n.pub,tag:"publish",app:o}),await r({pubkey:n.pub,tag:"host",appHash:o.hash,allowed:!0}),async(i,s,c=null)=>{const a=await wl(s,o),f={tag:"call",pubkey:n.pub,appHash:o.hash,lamHash:a,host:i,argument:c};return await r(f)}}const Ce={self:"npub1self",other:"npub1other",getTable:(t,e)=>({get:()=>Promise.resolve(e),set:()=>Promise.resolve(),update:()=>Promise.resolve(),delete:()=>Promise.resolve(),other:{get:()=>Promise.resolve(e),set:()=>Promise.resolve(),update:()=>Promise.resolve(),delete:()=>Promise.resolve()}})};function Uo(t,e){return Io(t+e)}async function wl(t,e){const n=await Uo(t.toString(),e.hash);if(!Object.values(e.apiHashes).includes(n))throw new Error("illegal lambda");return n}async function bl(t){const e=t.getCtx.toString(),n=Object.fromEntries(Object.entries(t.api).map(([i,s])=>[i,s.toString()])),r=await Io(JSON.stringify({getCtx:e,api:n})),o={};for(const[i,s]of Object.entries(n))o[i]=await Uo(s.toString(),r);return{getCtx:e,api:n,hash:r,apiHashes:o}}const rt={getCtx:t=>({msgs:t.getTable("msgs",[]),username:t.getTable("username","anonynmous"),followers:t.getTable("followers",[]),follows:t.getTable("follows",[]),add:(e,n)=>e.update(r=>r.includes(n)?r:[...r,n])}),api:{sendMsg:async(t,e)=>{const n={self:t.self,other:t.other,content:e};await t.msgs.update(r=>[...r,n]),await t.msgs.other.update(r=>[...r,n])},seeMsgs:(t,e)=>t.msgs.get(),setUsername:(t,e)=>t.username.set(e),getUsername:(t,e)=>t.username.other.get(),follow:async t=>{await t.add(t.followers.other,t.self),await t.add(t.follows,t.other)},unfollow:async t=>{await t.followers.other.update(e=>e.filter(n=>n!==t.self)),await t.follows.update(e=>e.filter(n=>n!==t.other))},getFollowers:t=>t.followers.other.get(),getFollows:t=>t.follows.other.get()}},Yt=gl();function ml(t){const e=P("div","");return Yn(t,rt,Kt).then(async n=>{n(Kt.pub,rt.api.setUsername,"bob"),console.log("bob logged in")}).then(()=>{Yn(t,rt,Yt).then(async n=>{const r=P("h1","Logged in as ");e.appendChild(r);const o=P("button","","");o.onclick=()=>{const l=P("div",""),d=Gn(l);l.appendChild(P("h2","Change Username"));const p=P("input","");p.value=s.get(),p.addEventListener("keydown",async b=>{b.key==="Enter"&&(n(Yt.pub,rt.api.setUsername,p.value).then(()=>{s.set(p.value)}),d())}),p.focus(),l.appendChild(p)},r.appendChild(o);const i=new Jn(Kt.pub),s=new Jn("anonynmous");n(Yt.pub,rt.api.getUsername).then(l=>{s.set(l)}),s.subscribe(l=>{o.innerHTML=l});const c=new Map,a=async l=>{if(c.has(l))return c.get(l);const d=await n(l,rt.api.getUsername);return c.set(l,d),d},f=P("button","chatting with","",{onclick:()=>{const l=P("div","");l.appendChild(P("h2","active users"));const d=Gn(l);c.forEach((p,b)=>{const v=P("p",p,"",{onclick:async()=>{i.set(b),y(),d()}});l.appendChild(v)})}});e.appendChild(f),i.subscribe(async l=>{a(l).then(d=>{f.innerHTML=`Chatting with ${d}`})});const h=P("div","");e.appendChild(h);const u=P("input","");u.setAttribute("type","text"),u.setAttribute("placeholder","Type a message"),e.appendChild(u),n(Kt.pub,rt.api.follow).then(()=>{console.log("following bob"),n(Kt.pub,rt.api.getFollowers).then(l=>{l.forEach(a),console.log("followers",l)})});const y=()=>n(Yt.pub,rt.api.seeMsgs).then(async l=>{h.innerText="";for(let d of l){if(d.self!==i.get()&&d.other!==i.get())continue;const p=await a(d.self);h.appendChild(P("p",`${p}: ${d.content}`))}});async function m(){const l=u.value;l&&(await n(i.get(),rt.api.sendMsg,l),y(),u.value="")}const g=P("button","send");g.onclick=()=>m(),u.addEventListener("keydown",async l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),await m())}),e.appendChild(g),y()})}),e}const El=t=>{const e=[[{type:"rook",color:"white"},{type:"knight",color:"white"},{type:"bishop",color:"white"},{type:"queen",color:"white"},{type:"king",color:"white"},{type:"bishop",color:"white"},{type:"knight",color:"white"},{type:"rook",color:"white"}],[{type:"pawn",color:"white"},{type:"pawn",color:"white"},{type:"pawn",color:"white"},{type:"pawn",color:"white"},{type:"pawn",color:"white"},{type:"pawn",color:"white"},{type:"pawn",color:"white"},{type:"pawn",color:"white"}],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[{type:"pawn",color:"black"},{type:"pawn",color:"black"},{type:"pawn",color:"black"},{type:"pawn",color:"black"},{type:"pawn",color:"black"},{type:"pawn",color:"black"},{type:"pawn",color:"black"},{type:"pawn",color:"black"}],[{type:"rook",color:"black"},{type:"knight",color:"black"},{type:"bishop",color:"black"},{type:"queen",color:"black"},{type:"king",color:"black"},{type:"bishop",color:"black"},{type:"knight",color:"black"},{type:"rook",color:"black"}]];function n(l){return[l%10,Math.floor(l/10)]}function r(l){return l[0]+l[1]*10}if(r(n(21))!=21)throw new Error("posVec failed");function o(l){const[d,p]=n(l);return d>=0&&d<8&&p>=0&&p<8}function i(l,d){const[p,b]=n(d);return l[b][p]}function s(l,d,p){const[b,v]=n(d);l[v][b]=p}function c(l,d){for(let p=0;p<8;p++)for(let b=0;b<8;b++){const v=l[p][b];if(v&&v.color===d&&v.type==="king")return p*10+b}return null}const a=[10,-10,1,-1],f=[11,-11,9,-9];function h(l){switch(l.type){case"pawnmoved":case"pawnmoveddouble":return l.color==="white"?[10]:[-10];case"pawn":return l.color==="white"?[10,20]:[-10,-20];case"knight":return[12,8,21,19,-12,8,-21,-19];case"bishop":return f;case"rook":case"rookmoved":return a;case"queen":case"king":case"kingmoved":return f.concat(a)}}function u(l,d){const[p,b]=n(l),[v,L]=d;return r([p+v,b+L])}function y(l,d){var _,x;const p=i(l,d);if(!p)return[];let b=[],v=p.type;const L=h(p);if(v.startsWith("pawn")){b=L.map(A=>d+A).filter(o).filter(A=>i(l,A)==null);const k=p.color=="white"?1:-1;b=b.concat([1,-1].map(A=>u(d,[A,k])).filter(o).filter(A=>{let $=i(l,A);return $?$.color!=p.color:($=i(l,A-k*10),$&&$.color!=p.color&&$.type=="pawnmoveddouble")}))}else{const k=v.startsWith("rook")||v.startsWith("bishop")||v.startsWith("queen");for(let A of L){let $=d;for(;$=$+A,!!o($);){const I=i(l,$);if(I){p.color!==I.color&&b.push($);break}if(b.push($),!k)break}}v=="king"&&(i(l,d+1)==null&&i(l,d+2)==null&&((_=i(l,d+3))==null?void 0:_.type)=="rook"&&b.push(d+2),i(l,d-1)==null&&i(l,d-2)==null&&((x=i(l,d-4))==null?void 0:x.type)=="rook"&&b.push(d-2))}return b}function m(l,d){return y(l,d)}function g(l,d){if(l.winner!=null)return l;let p=i(l.board,d.start);if(!p||p.color!==l.turn||!m(l.board,d.start).includes(d.end))return l;if((p.type=="pawn"||p.type=="king"||p.type=="rook")&&(p.type+="moved"),p.type=="pawnmoved"&&Math.abs(d.end-d.start)==20&&(p.type="pawnmoveddouble"),p.type.startsWith("pawn")&&d.start%10!=d.end%10&&i(l.board,d.end)==null&&s(l.board,r([d.end%10,Math.floor(d.start/10)]),null),p.type.startsWith("king")){const v=d.start-d.end;v==2&&(s(l.board,d.end+1,{...p,type:"rookmoved"}),s(l.board,d.end-2,null)),v==-2&&(s(l.board,d.end-1,{...p,type:"rookmoved"}),s(l.board,d.end+1,null))}if(s(l.board,d.end,p),p.type.startsWith("pawn")){const v=Math.floor(d.end/10);(v==0||v==7)&&s(l.board,d.end,{...p,type:d.promo})}return s(l.board,d.start,null),l.turn=l.turn==="white"?"black":"white",c(l.board,l.turn)==null&&(l.winner=l.turn==="white"?"black":"white"),l}return{startBoard:e,hosting:t.getTable("hosting",null),playing:t.getTable("playing",null),invites:t.getTable("invites",[]),add:(l,d)=>l.update(p=>p.includes(d)?p:[...p,d]),makeMove:g}},vl={pawn:"p",knight:"N",bishop:"B",rook:"R",queen:"Q",king:"K",kingmoved:"K",rookmoved:"R",pawnmoved:"p",pawnmoveddouble:"p"},xl=t=>{const e=El(Ce);let n={white:Ce.self,black:Ce.other,board:e.startBoard,turn:"white",winner:null};const r=P("div","","chessboard");r.style.backgroundColor="#f0d9b5";const o=(window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight)*.6;r.style.width=o+"px",r.style.height=o+"px",r.style.margin="auto",r.style.position="relative",r.style.cursor="pointer";let i=null;const s=()=>{r.innerHTML="";for(let c=0;c<8;c++)for(let a=0;a<8;a++){const f=P("div","","square");f.style.width=o/8+"px",f.style.height=o/8+"px",r.appendChild(f),f.style.backgroundColor=(a+c)%2===0?"#b58863":"#f0d9b5",i&&i[0]===a&&i[1]===c&&(f.style.backgroundColor=(a+c)%2===0?"#c9b18f":"#ffd7be"),f.style.left=c*o/8+"px",f.style.bottom=a*o/8+"px",f.style.position="absolute",f.onclick=u=>{i&&i[0]===a&&i[1]===c?i=null:(i&&(n=e.makeMove(n,{start:i[0]*10+i[1],end:a*10+c,promo:"queen"})),i=[a,c]),s()};const h=n.board[a][c];if(h){const u=P("div",vl[h.type],"piece");u.style.width=o/8+"px",u.style.height=o/8+"px",u.style.position="absolute",f.appendChild(u),u.style.color=h.color==="white"?"white":"black",u.style.fontWeight="bold",u.style.fontSize=o/8+"px"}}};return s(),P("div","","",{children:[P("h1","Chess"),P("p","Welcome to the chess page"),r]})},Ke="LamBox";function $o(){const t=window.location.pathname.split("/").filter(Boolean);console.log({items:t});const e=t.includes("local"),n=!t.includes(Ke);return{serverLocal:e,frontendLocal:n,path:t.filter(r=>r!="local"&&r!=Ke)}}let It=$o();const Al=It.serverLocal?"http://localhost:8080":"https://lambox.chickenkiller.com/",Ve=document.body;console.log("starting client on locatino",It);Ve.appendChild(P("h2","lambox test"));const kl=()=>P("div","","",{children:[P("h1","Home"),P("p","Welcome to the lambox"),...Co.filter(t=>t.path).map(t=>P("p",t.path,"",{onclick:()=>{Ln(t.path.split("/"))}}))]}),Co=[{init:kl,path:"",cache:void 0},{init:ml,path:"chat",cache:void 0},{init:xl,path:"chess",cache:void 0}];Ln(It.path);window.addEventListener("popstate",t=>{It=$o(),Ln(It.path)});function Ln(t){const e=(It.serverLocal?"local":"")+"/"+(It.frontendLocal?"":Ke)+"/"+t.join("/");window.history.pushState({},"",e),console.log(e),Ve.innerHTML="";for(const n of Co)n.path===t.join("/")&&(n.cache||(n.cache=n.init(Al)),Ve.appendChild(n.cache))}
